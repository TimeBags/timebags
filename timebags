#!/usr/bin/env python3
# -*- coding: utf-8 -*-
# Copyright (C) 2019 The TimeBags developers
#
# This file is part of the TimeBags software.
#
# It is subject to the license terms in the LICENSE file
# found in the top-level directory of this distribution.
#
# No part of the Timebags software, including this file, may be copied,
# modified, propagated, or distributed except according to the terms
# contained in the LICENSE file.

'''
This file belong to [TimeBags Project](https://timebags.org)
'''

import sys
import logging
import os
import ctypes

import gui
import cli


def main():
    ''' Main '''

    home = os.path.expanduser("~")
    prefix = '.' if os.name != 'nt' else ''
    path_conf_dir = os.path.join(home, prefix + "timebags")
    if not os.path.exists(path_conf_dir):
        os.mkdir(path_conf_dir)
        if os.name == 'nt':
            if not ctypes.windll.kernel32.SetFileAttributesW(path_conf_dir, 0x02):
                raise ctypes.WinError()

    if not os.path.isdir(path_conf_dir):
        error = "unable to use configuration dir: " % path_conf_dir
        raise Exception(error)

    # default log to a file at DEBUG level if running in GUI mode
    logfile = os.path.join(path_conf_dir, "debug.log")
    logging.basicConfig(filename=logfile, filemode='w', level=logging.DEBUG)


    # TBD: it's better to have timebags-qt and timebags-cli and check sys.argv[0],
    #      but how to do with pyinstaller and AppImage?
    if len(sys.argv) == 1:
        # TBD: check an option like --gui
        ret = gui.main()
    elif len(sys.argv) > 1:
        ret = cli.main(sys.argv[1:])
    if ret is not None:
        print(ret)
        return 0
    print("ERROR: check log for details")
    return 1


if __name__ == '__main__':
    sys.exit(main())
